<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>차량 관리</title>
    <style>
        .car-image {
            width: 150px;
            height: auto;
        }
    </style>
</head>

<body>
<div layout:fragment="content" class="content">
    <h1 class="mb-4">차량 관리</h1>

    <!-- 검색 영역 -->
    <div class="row mb-4">
        <div class="col-md-6">
            <form class="input-group" method="GET" th:action="@{/admin/cars}">
                <input type="text" class="form-control" placeholder="차량 번호판으로 검색 (예: 303누 7499) [띄어쓰기 필수]"
                       aria-label="Search" name="licensePlate" id="licensePlate"
                       th:value="${param.licensePlate}">
                <button class="btn btn-primary" type="submit">검색</button>
            </form>
        </div>
    </div>

    <!-- 차량 목록 테이블 -->
    <div class="table-responsive">
        <h2 class="mb-3">등록된 차량 목록</h2>
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
            <tr>
                <th>이미지</th>
                <th>이름</th>
                <th>브랜드</th>
                <th>모델</th>
                <th>번호판</th>
                <th>등록일자</th>
                <th>주행거리</th>
                <th>가격</th>
                <th>상태</th> <!-- 상태 추가 -->
                <th>상세 정보</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="car : ${cars.content}">
                <td>
                    <img th:src="${car.mainImage}" alt="Car Image" class="img-thumbnail car-image">
                </td>
                <td th:text="${car.name}">이름</td>
                <td th:text="${car.brand}">브랜드</td>
                <td th:text="${car.model}">모델</td>
                <td th:text="${car.licensePlate}">번호판</td>
                <td th:text="${T(java.time.format.DateTimeFormatter).ofPattern('yyyy-MM-dd').format(car.registrationDate)}">
                    등록일자
                </td>
                <td th:text="${car.mileage + ' km'}">주행거리</td>
                <td th:text="${car.price + '원'}">가격</td>
                <td>
                    <!-- 상태값에 따라 Bootstrap 배지 색상 변경 -->
                    <span th:classappend="'badge ' +
            (car.status == 'AVAILABLE_FOR_PURCHASE' ? 'bg-green' :
            (car.status == 'PENDING_PURCHASE_APPROVAL' ? 'bg-warning' :
            (car.status == 'NOT_AVAILABLE_FOR_PURCHASE' ? 'bg-danger' :
            (car.status == 'PENDING_SALE' ? 'bg-info' :
            (car.status == 'SALE_APPROVED' ? 'bg-primary' : 'bg-secondary')))))"
                          th:text="${car.status}">
          </span>
                </td>
                <td>
                    <a th:href="@{/admin/car/details/{id}(id=${car.id})}" class="btn btn-info btn-sm">보기</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- 페이징 네비게이션 -->
    <nav th:if="${cars.totalPages > 1}" class="d-flex justify-content-center mt-4">
        <ul class="pagination">
            <!-- 이전 버튼 -->
            <li class="page-item" th:classappend="${cars.number == 0 ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/admin/cars(page=${cars.number - 1}, licensePlate=${param.licensePlate})}">
                    이전
                </a>
            </li>

            <!-- 첫 두 페이지 -->
            <li class="page-item" th:each="i : ${#numbers.sequence(0, 1)}" th:if="${cars.totalPages > 2}">
                <a class="page-link" th:href="@{/admin/cars(page=${i}, licensePlate=${param.licensePlate})}"
                   th:text="${i + 1}">
                </a>
            </li>

            <!-- 생략 표시 -->
            <li class="page-item" th:if="${cars.number > 2}">
                <span class="page-link">...</span>
            </li>

            <!-- 중심 페이지들 -->
            <li class="page-item" th:each="i : ${#numbers.sequence(cars.number - 2, cars.number + 2)}"
                th:if="${i >= 2 && i <= cars.totalPages - 3}"
                th:classappend="${cars.number == i ? 'active' : ''}">
                <a class="page-link" th:href="@{/admin/cars(page=${i}, licensePlate=${param.licensePlate})}"
                   th:text="${i + 1}">
                </a>
            </li>

            <!-- 생략 표시 -->
            <li class="page-item" th:if="${cars.number < cars.totalPages - 3}">
                <span class="page-link">...</span>
            </li>

            <!-- 마지막 두 페이지 -->
            <li class="page-item" th:each="i : ${#numbers.sequence(cars.totalPages - 2, cars.totalPages - 1)}"
                th:if="${cars.totalPages > 2}">
                <a class="page-link" th:href="@{/admin/cars(page=${i}, licensePlate=${param.licensePlate})}"
                   th:text="${i + 1}">
                </a>
            </li>

            <!-- 다음 버튼 -->
            <li class="page-item" th:classappend="${cars.number + 1 == cars.totalPages ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/admin/cars(page=${cars.number + 1}, licensePlate=${param.licensePlate})}">
                    다음
                </a>
            </li>
        </ul>
    </nav>


</div>

</body>
</html>
