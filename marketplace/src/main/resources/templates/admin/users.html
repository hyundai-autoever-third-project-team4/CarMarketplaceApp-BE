<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout}">
<head>
    <title>사용자 관리</title>
    <!-- Bootstrap Modal Style -->
    <style>
        .modal-header {
            background-color: #343a40;
            color: white;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <h1>사용자 관리</h1>
    <hr>

    <!-- 총 가입자 수 -->
    <div class="alert alert-primary" role="alert">
        <strong>총 가입자 수:</strong> <span th:text="${users.size()}"></span>명
    </div>

    <!-- 사용자 검색 -->
    <div class="my-4">
        <form class="row g-3" th:action="@{/admin/users/search}" method="get">
            <div class="col-md-8">
                <input type="text" class="form-control" id="search" name="query" placeholder="이메일 또는 이름으로 검색" aria-label="Search">
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" type="submit">검색</button>
            </div>
        </form>
    </div>
    <!-- 사용자 목록 -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>이메일</th>
                <th>이름</th>
                <th>역할</th>
                <th>리뷰 수</th>
                <th>판매 기록</th>
                <th>구매 기록</th>
                <th>예약 수</th>
                <th>상세보기</th>
                <th>삭제</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.id}"></td>
                <td th:text="${user.email}"></td>
                <td th:text="${user.name}"></td>
                <td>
                    <span class="badge" th:classappend="${user.role == 'ROLE_ADMIN' ? 'bg-warning' : 'bg-success'}" th:text="${user.role}"></span>
                </td>
                <td th:text="${user.reviewCount}"></td>
                <td th:text="${user.salesCount}"></td>
                <td th:text="${user.purchaseCount}"></td>
                <td th:text="${user.reservationCount}"></td>
                <td>
                    <button type="button" class="btn btn-info btn-sm text-white" data-bs-toggle="modal" th:attr="data-bs-target='#userModal_' + ${user.id}">
                        상세보기
                    </button>
                </td>
                <td>
                    <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" method="post" th:onsubmit="return confirm('정말로 삭제하시겠습니까?');">
                        <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- 모달 -->
    <div th:each="user : ${users}">
        <div class="modal fade" th:id="'userModal_' + ${user.id}" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content border-0 shadow-lg" style="border-radius: 20px; overflow: hidden;">
                    <!-- 모달 헤더 -->
                    <div class="modal-header bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4">
                        <h5 class="modal-title fw-bold ms-2" th:text="'사용자 상세정보 - ' + ${user.name}" id="userModalLabel" style="font-size: 1.5rem;"></h5>
                        <button type="button" class="btn-close btn-close-white me-2" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!-- 모달 본문 -->
                    <div class="modal-body p-4" style="background: linear-gradient(to bottom, #f8f9fa, #ffffff);">
                        <div class="row align-items-center">
                            <!-- 사용자 이미지 섹션 -->
                            <div class="col-md-4 text-center">
                                <div class="position-relative d-inline-block mb-4">
                                    <img th:src="'https://chajava-storage.s3.ap-northeast-2.amazonaws.com/profiles/profile.webp'"
                                         class="img-fluid rounded-circle shadow-lg border-4 hover:scale-105 transition-transform duration-300"
                                         style="width: 180px; height: 180px; border: 4px solid #6366f1;"
                                         alt="사용자 이미지">
                                    <div class="position-absolute bottom-0 end-0">
                                    <span class="badge rounded-pill bg-success p-2">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                    </div>
                                </div>
                                <h4 class="fw-bold mb-2" style="color: #4f46e5;" th:text="${user.name}"></h4>
                                <p class="text-muted mb-2" style="font-size: 0.95rem;" th:text="${user.email}"></p>
                                <span class="badge bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-3 py-2 rounded-pill"
                                      th:text="'Role: ' + ${user.role}"
                                      style="font-size: 0.9rem;"></span>
                            </div>
                            <!-- 사용자 상세 정보 -->
                            <div class="col-md-8">
                                <div class="list-group shadow-sm">
                                    <div class="list-group-item border-0 mb-2 rounded-3 hover:bg-gray-50 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">ID</span>
                                            <span class="text-primary" th:text="${user.id}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 mb-2 rounded-3 bg-blue-50 hover:bg-blue-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">전화번호</span>
                                            <span class="text-primary" th:text="${user.phone.substring(0, 3) + '-' + user.phone.substring(3, 7) + '-' + user.phone.substring(7)}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 mb-2 rounded-3 bg-yellow-50 hover:bg-yellow-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">주소</span>
                                            <span class="text-gray-600" th:text="${user.address}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 mb-2 rounded-3 bg-purple-50 hover:bg-purple-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">리뷰 수</span>
                                            <span class="text-purple-600" th:text="${user.reviewCount}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 mb-2 rounded-3 bg-red-50 hover:bg-red-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">판매 기록</span>
                                            <span class="text-red-600" th:text="${user.salesCount}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 mb-2 rounded-3 bg-green-50 hover:bg-green-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">구매 기록</span>
                                            <span class="text-green-600" th:text="${user.purchaseCount}"></span>
                                        </div>
                                    </div>
                                    <div class="list-group-item border-0 rounded-3 bg-gray-50 hover:bg-gray-100 transition-all duration-300">
                                        <div class="d-flex justify-content-between align-items-center p-2">
                                            <span class="fw-semibold text-gray-700">예약 수</span>
                                            <span class="text-gray-600" th:text="${user.reservationCount}"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 모달 푸터 -->
                    <div class="modal-footer border-0 bg-light">
                        <button type="button" class="btn btn-light hover:bg-gray-200 transition-colors duration-300 rounded-pill px-4" data-bs-dismiss="modal">
                            닫기
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>




</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
